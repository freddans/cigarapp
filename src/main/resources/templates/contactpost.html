<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Contact</title>
    <link rel="stylesheet" href="/css/contactpost.css">

</head>
<body>

<center>
    <div class="home">
        <div class="pre-container" align="left">
            <div class="contactpost-container" th:each="contactPost : ${contactPosts}"
                 onclick="showContactPostProfile(this)">
                <form th:action="@{'/deleteContactPost/' + ${contactPost.id}}" method="post">
                    <button class="delete-button" onclick="deleteContactPost(event, ${contactPost.id})">delete</button>
                </form>

                <span class="invisible" th:text="${contactPost.id}"></span>
                <p class="name" th:text="${contactPost.name}"></p>
                <p class="email" th:text="${contactPost.email}"></p>
                <p class="msg" th:text="${contactPost.message}"></p>
                <button class="done-button" onclick="changeBackground(this.parentNode)">done</button>
            </div> <!-- /inner div -->
            </form>
        </div>

        <!-- Placeholder for clicked content -->
        <div id="clickedContent" class="clickedContent"></div>
    </div>
</center>

<script>
    function showContactPostProfile(row) {
        // Check if the clicked element is the "done" button or the "delete" button
        if (!event.target.classList.contains('done-button') && !event.target.classList.contains('delete-button')) {
            // Remove 'selected' class from all rows
            var rows = document.querySelectorAll(".pre-container");
            rows.forEach(function (row) {
                row.classList.remove('selected');
            });

            // Add 'selected' class to the clicked row
            row.classList.add('selected');

            // Get contact data from the clicked row
            var postId = row.querySelector('.invisible').textContent;
            var name = row.querySelector('.name').textContent;
            var email = row.querySelector('.email').textContent;
            var message = row.querySelector('.msg').textContent;

            // Display the contact profile data in the clickedContent div
            var clickedContent = document.getElementById('clickedContent');
            clickedContent.innerHTML = getContactPostProfileById(postId, name, email, message);

            // Show the clickedContent div
            clickedContent.style.display = 'block';
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        // Function to adjust the position of the clicked content container when scrolling
        window.onscroll = function () {
            adjustProfileContainerPosition();
        };

        // Example function to adjust position
        function adjustProfileContainerPosition() {
            // Your adjustment logic here
        }
    });

    function getContactPostProfileById(postId, name, email, message) {
        var profileContent = "<h2>Contact Post</h2>";
        profileContent += "<p>Post id: " + postId + "</p>";
        profileContent += "<p align='left'>Name:</p>";
        profileContent += "<div class='textbox'>" + name + "</div>"; // Name textbox
        profileContent += "<p align='left'>Email:</p>";
        profileContent += "<div class='textbox'>" + email + "</div>"; // Email textbox
        profileContent += "<p alignt='left'>Message:</p>";
        profileContent += "<textarea readonly>" + message + "</textarea>";
        profileContent += "<button class='close-button' onclick='closeClickedContent()'>Close</button>";

        return profileContent;
    }

    function changeBackground(container) {
        var deleteButton = container.querySelector('.delete-button');
        if (container.style.backgroundColor === "orange") {
            container.style.backgroundColor = "rgba(0, 0, 0, 0.4)";
            deleteButton.style.display = 'none';
        } else {
            container.style.backgroundColor = "orange";
            deleteButton.style.display = 'block';
        }
    }

    function closeClickedContent() {
        var clickedContent = document.getElementById('clickedContent');
        if (clickedContent.style.display === 'block') {
            clickedContent.style.display = 'none';
        } else {
            clickedContent.style.display = 'block'
        }
    }

    function deleteContactPost(event, postId) {
        // Prevent the event from propagating to parent elements
        event.stopPropagation();

        // Send an AJAX request to delete the contact post
        var xhr = new XMLHttpRequest();
        xhr.open("DELETE", "/deleteContactPost/" + postId, true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    // Handle success response if needed
                    console.log("Contact post deleted successfully");
                    location.reload(); // Reload the page for example
                } else {
                    // Handle error response if needed
                    console.error("Error deleting contact post");
                }
            }
        };
        xhr.send();
    }
</script>

</body>
</html>
